{% extends 'base.html' %}
{% load tracker_filters %}

{% block title %}Forecast - {{ tracker.name }}{% endblock %}

{% block content %}
<div class="main-content">
    <div style="margin-bottom: 2rem;">
        <a href="{% url 'tracker_detail' tracker.tracker_id %}" class="btn btn-ghost">‚Üê Back</a>
        <h1 style="margin: 1rem 0;">üìà Forecasts</h1>
        <p class="text-secondary">Future predictions based on historical data</p>
    </div>

    <!-- Trend Info -->
    <div class="grid-3" style="margin-bottom: 2rem;">
        <div class="card">
            <div class="stat-item">
                <div class="stat-value">{{ ts_data.trend.direction|title }}</div>
                <div class="stat-label">Trend Direction</div>
            </div>
        </div>
        <div class="card">
            <div class="stat-item">
                <div class="stat-value">{{ ts_data.trend.r_squared|floatformat:2 }}</div>
                <div class="stat-label">R¬≤ (Fit Quality)</div>
            </div>
        </div>
        <div class="card">
            <div class="stat-item">
                <div class="stat-value">{{ trends.trend_direction|title }}</div>
                <div class="stat-label">Smoothed Trend</div>
                <p class="text-secondary" style="font-size: 0.75rem;">
                    {{ trends.improving_periods }}/{{ trends.total_periods }} improving
                </p>
            </div>
        </div>
    </div>

    <!-- Forecast Chart -->
    {% if forecast_chart %}
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-header">
            <h3>7-Day Forecast</h3>
            <p class="text-secondary">Blue: historical data | Orange: forecast with 95% confidence interval</p>
        </div>
        <img src="data:image/png;base64,{{ forecast_chart }}" alt="Forecast" style="width: 100%; height: auto;">
    </div>
    {% endif %}

    <!-- Forecast Values -->
    {% if ts_data.forecast.forecast %}
    <div class="card">
        <div class="card-header">
            <h3>Forecast Values</h3>
        </div>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--color-border);">
                        <th style="padding: 0.75rem; text-align: left;">Day</th>
                        <th style="padding: 0.75rem; text-align: center;">Forecast</th>
                        <th style="padding: 0.75rem; text-align: center;">Lower Bound</th>
                        <th style="padding: 0.75rem; text-align: center;">Upper Bound</th>
                    </tr>
                </thead>
                <tbody>
                    {% for value in ts_data.forecast.forecast %}
                    <tr style="border-bottom: 1px solid var(--color-border);">
                        <td style="padding: 0.75rem;">Day +{{ forloop.counter }}</td>
                        <td style="padding: 0.75rem; text-align: center; font-weight: 600;">{{ value|floatformat:1 }}%
                        </td>
                        <td style="padding: 0.75rem; text-align: center;" class="text-secondary">{{ ts_data.forecast.confidence_lower|get_item:forloop.counter0|floatformat:1 }}%</td>
                        <td style="padding: 0.75rem; text-align: center;" class="text-secondary">{{ ts_data.forecast.confidence_upper|get_item:forloop.counter0|floatformat:1 }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}