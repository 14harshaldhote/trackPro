{% extends 'base.html' %}

{% block content %}
<div class="panel fade-in">
    <header class="panel-header mb-8 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold">My Trackers</h1>
            <p class="text-secondary text-sm mt-1">{{ total_count }} active tracker{{ total_count|pluralize }}</p>
        </div>
        <button class="btn btn-primary flex items-center gap-2" onclick="window.openModal('add-tracker')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Tracker
        </button>
    </header>

    {% if trackers %}
    <div class="grid-responsive">
        {% for tracker in trackers %}
        <div class="tracker-card card group" data-tracker-id="{{ tracker.id }}">
            <a href="/tracker/{{ tracker.id }}/" class="block">
                <div class="flex justify-between items-start mb-4">
                    <div class="tracker-icon">
                        üìù
                    </div>
                    <div class="tracker-menu dropdown relative"
                        onclick="event.preventDefault(); event.stopPropagation();">
                        <button class="btn-icon opacity-0 group-hover:opacity-100 transition-opacity"
                            data-dropdown-toggle="tracker-{{ tracker.id }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                        <div class="dropdown-menu right" id="dropdown-tracker-{{ tracker.id }}">
                            <button class="dropdown-item"
                                onclick="event.preventDefault(); window.openModal('edit-tracker', {tracker_id: '{{ tracker.id }}'})">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 20h9"></path>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                                </svg>
                                Edit
                            </button>
                            <button class="dropdown-item text-error"
                                onclick="event.preventDefault(); archiveTracker('{{ tracker.id }}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                                Archive
                            </button>
                        </div>
                    </div>
                </div>

                <h3 class="tracker-title">{{ tracker.name }}</h3>
                <p class="tracker-description">{{ tracker.description|default:"No description" }}</p>

                <div class="tracker-meta">
                    <span class="tracker-badge">{{ tracker.time_period }}</span>
                    <span class="tracker-task-count">{{ tracker.task_count }} task{{ tracker.task_count|pluralize }}</span>
                </div>

                <div class="tracker-progress">
                    <div class="tracker-progress-bar">
                        <div class="tracker-progress-fill" style="width: {{ tracker.progress }}%"></div>
                    </div>
                    <span class="tracker-progress-text">{{ tracker.progress }}%</span>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    {% if has_more %}
    <div class="flex justify-center mt-8">
        <button class="btn btn-secondary" onclick="loadMoreTrackers({{ next_page }})">
            Load More Trackers
        </button>
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state card p-12 text-center">
        <div class="empty-icon text-6xl mb-4">üéØ</div>
        <h3 class="text-2xl font-bold mb-2">No Active Trackers</h3>
        <p class="text-secondary mb-6 max-w-md mx-auto">Create your first tracker to start building better habits and
            achieving your goals.</p>
        <button class="btn btn-primary btn-lg" onclick="window.openModal('add-tracker')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                class="mr-2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Your First Tracker
        </button>
    </div>
    {% endif %}

    <!-- Archived Section -->
    {% if archived_trackers %}
    <div class="mt-12 pt-8 border-t border-border">
        <div class="flex items-center gap-3 mb-4">
            <h3 class="text-lg font-bold text-secondary">Archived Trackers</h3>
            <span class="text-xs text-secondary bg-surface-alt px-2 py-1 rounded">{{ archived_trackers|length }}</span>
        </div>
        <div class="archived-trackers opacity-60 hover:opacity-100 transition-opacity">
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                {% for tracker in archived_trackers %}
                <div class="card p-4 bg-surface-alt" data-archived-id="{{ tracker.id }}">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-medium text-sm">{{ tracker.name }}</span>
                        <span class="text-xs text-secondary capitalize">{{ tracker.time_period }}</span>
                    </div>
                    <button class="text-xs text-primary hover:underline font-medium mt-2"
                        onclick="restoreTracker('{{ tracker.id }}')">
                        ‚Ü∂ Restore
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}