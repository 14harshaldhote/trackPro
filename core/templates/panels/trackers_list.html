{% load static %}
<div class="panel" data-panel="trackers-list">
    <div class="breadcrumb">
        <a href="/">Home</a>
        <span class="breadcrumb-separator">‚Ä∫</span>
        <span>Trackers</span>
    </div>

    <div class="panel-header">
        <div>
            <h1 class="panel-title">Your Trackers</h1>
            <p style="color: var(--color-text-secondary); margin: 0.5rem 0 0;">
                {{ total_count }} active tracker{{ total_count|pluralize }}
            </p>
        </div>

        <div class="panel-actions">
            <button class="btn btn-primary" data-action="add-tracker">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                        clip-rule="evenodd" />
                </svg>
                New Tracker
            </button>
        </div>
    </div>

    <!-- Active Trackers -->
    {% if trackers %}
    <section style="margin-bottom: 3rem;">
        <div class="tracker-grid"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
            {% for tracker in trackers %}
            <div class="tracker-card-detailed"
                style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 1.5rem; transition: all 0.2s;">
                <div class="tracker-card-header"
                    style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0 0 0.25rem;">
                            {{ tracker.name }}
                        </h3>
                        {% if tracker.description %}
                        <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin: 0;">
                            {{ tracker.description|truncatechars:60 }}
                        </p>
                        {% endif %}
                    </div>

                    <div class="dropdown">
                        <button class="btn-icon dropdown-toggle" aria-label="More options">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
                            </svg>
                        </button>
                        <div class="dropdown-menu">
                            <a href="/tracker/{{ tracker.tracker_id }}/" class="dropdown-item">View Details</a>
                            <button class="dropdown-item" data-action="edit-tracker"
                                data-tracker-id="{{ tracker.tracker_id }}">Edit</button>
                            <button class="dropdown-item" data-action="pause-tracker"
                                data-tracker-id="{{ tracker.tracker_id }}">
                                {% if tracker.status == 'paused' %}Resume{% else %}Pause{% endif %}
                            </button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item dropdown-item-danger" data-action="delete-tracker"
                                data-tracker-id="{{ tracker.tracker_id }}">Delete</button>
                        </div>
                    </div>
                </div>

                <div class="tracker-meta" style="display: flex; gap: 1rem; margin-bottom: 1rem; font-size: 0.875rem;">
                    <span class="tracker-period"
                        style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; background: var(--color-bg); border-radius: 6px;">
                        {% if tracker.time_period == 'daily' %}
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6z" />
                        </svg>
                        {% elif tracker.time_period == 'weekly' %}
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2h6v2H7V4zm0 4h6v2H7V8zm0 4h6v2H7v-2z" />
                        </svg>
                        {% else %}
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1z" />
                        </svg>
                        {% endif %}
                        {{ tracker.time_period|title }}
                    </span>

                    {% if tracker.status == 'paused' %}
                    <span style="color: var(--color-warning);">‚è∏ Paused</span>
                    {% endif %}
                </div>

                <div class="tracker-progress-section" style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.875rem; color: var(--color-text-secondary);">Progress</span>
                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--color-primary);">
                            {{ tracker.progress }}%
                        </span>
                    </div>
                    <div class="progress-bar"
                        style="height: 8px; background: var(--color-bg); border-radius: 4px; overflow: hidden;">
                        <div class="progress-fill"
                            style="height: 100%; background: var(--color-primary); width: {{ tracker.progress }}%; transition: width 0.3s;">
                        </div>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem; color: var(--color-text-tertiary);">
                        <span>{{ tracker.completed_count }} completed</span>
                        <span>{{ tracker.task_count }} total tasks</span>
                    </div>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <a href="/tracker/{{ tracker.tracker_id }}/" class="btn btn-secondary btn-sm"
                        style="flex: 1; text-align: center; text-decoration: none;">
                        View Details
                    </a>
                    <button class="btn btn-primary btn-sm" data-action="add-task"
                        data-tracker-id="{{ tracker.tracker_id }}" style="flex: 1;">
                        Add Task
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if has_more %}
        <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-secondary" data-action="load-more" data-page="{{ next_page }}">
                Load More Trackers
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="margin-left: 0.5rem;">
                    <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        {% endif %}
    </section>
    {% else %}
    <div class="empty-state">
        <svg class="empty-state-icon" width="80" height="80" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
                d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V8z"
                clip-rule="evenodd" />
        </svg>
        <h3 class="empty-state-title">No trackers yet</h3>
        <p class="empty-state-description">Create your first tracker to start monitoring your habits and goals</p>
        <button class="btn btn-primary" data-action="add-tracker">Create Your First Tracker</button>
    </div>
    {% endif %}

    <!-- Archived Trackers -->
    {% if archived_trackers %}
    <section>
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: var(--color-text-secondary);">
            üì¶ Archived Trackers
        </h2>
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            {% for tracker in archived_trackers %}
            <div
                style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--color-bg); border-radius: 8px;">
                <div>
                    <strong>{{ tracker.name }}</strong>
                    <span style="margin-left: 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary);">
                        {{ tracker.time_period|title }}
                    </span>
                </div>
                <button class="btn btn-sm btn-secondary" data-action="restore-tracker"
                    data-tracker-id="{{ tracker.tracker_id }}">
                    Restore
                </button>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<style>
    .tracker-card-detailed:hover {
        border-color: var(--color-primary);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }
</style>