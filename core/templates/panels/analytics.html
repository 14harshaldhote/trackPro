{% load static %}
<div class="panel" data-panel="analytics">
    <div class="breadcrumb">
        <a href="/">Home</a>
        <span class="breadcrumb-separator">â€º</span>
        <span>Analytics</span>
    </div>

    <div class="panel-header">
        <h1 class="panel-title">ðŸ“Š Analytics Dashboard</h1>
        <div class="panel-actions">
            <select class="btn btn-secondary" id="timeframe-select">
                <option value="7d">Last 7 Days</option>
                <option value="30d" selected>Last 30 Days</option>
                <option value="90d">Last 90 Days</option>
                <option value="all">All Time</option>
            </select>
        </div>
    </div>

    <!-- Overview Stats -->
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="stat-card">
            <div class="stat-value">{{ overview_stats.total_tasks }}</div>
            <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ overview_stats.completion_rate }}%</div>
            <div class="stat-label">Completion Rate</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ overview_stats.current_streak }}</div>
            <div class="stat-label">Current Streak</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ overview_stats.longest_streak }}</div>
            <div class="stat-label">Longest Streak</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ overview_stats.active_trackers }}</div>
            <div class="stat-label">Active Trackers</div>
        </div>
    </div>

    <!-- Charts Section -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
        <!-- Completion Trend Chart -->
        <div
            style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 1.5rem;">
            <h2 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Completion Trend</h2>
            <div id="completion-chart" style="min-height: 300px;">
                <!-- Chart will be rendered here by JavaScript -->
                <div
                    style="display: flex; align-items: center; justify-content: center; height: 300px; color: var(--color-text-secondary);">
                    <div style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
                        </svg>
                        <p style="margin-top: 0.5rem;">Load chart data via /api/chart-data/</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Distribution -->
        <div
            style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 1.5rem;">
            <h2 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">By Category</h2>
            <div id="category-chart" style="min-height: 300px;">
                {% if category_distribution %}
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    {% for category, data in category_distribution.items %}
                    <div>
                        <div
                            style="display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 0.25rem;">
                            <span>{{ category }}</span>
                            <span>{{ data.count }}</span>
                        </div>
                        <div class="progress-bar" style="height: 8px;">
                            <div style="width: {{ data.percentage }}%; background: var(--color-primary);"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tracker Breakdown -->
    <section style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Tracker Performance</h2>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for tracker in tracker_breakdown %}
            <div
                style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; padding: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <h3 style="font-weight: 600; margin: 0;">{{ tracker.name }}</h3>
                        <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin: 0.25rem 0 0;">
                            {{ tracker.time_period|title }}
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary);">{{
                            tracker.completion_rate }}%</div>
                        <div style="font-size: 0.75rem; color: var(--color-text-secondary);">{{ tracker.completed }}/{{
                            tracker.total }}</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div style="width: {{ tracker.completion_rate }}%; background: var(--color-primary);"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Top Insights -->
    {% if top_insights %}
    <section>
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ðŸ’¡ Key Insights</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% for insight in top_insights %}
            <div
                style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; padding: 1.5rem;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">{{ insight.icon|default:"ðŸ’¡" }}</div>
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">{{ insight.title }}</h3>
                <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin: 0;">{{ insight.description }}
                </p>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>