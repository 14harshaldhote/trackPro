{% extends 'base.html' %}

{% block content %}
<div class="panel fade-in">
    <!-- Enhanced Header -->
    <header class="dashboard-header">
        <div class="dashboard-welcome">
            <h1 class="dashboard-title">
                {% if time_of_day == 'morning' %}Good morning,
                {% elif time_of_day == 'afternoon' %}Good afternoon,
                {% else %}Good evening,
                {% endif %}
                {{ user.username }}
            </h1>
            <p class="dashboard-subtitle">{{ today|date:"l, F j, Y" }}</p>
        </div>
        <div class="dashboard-controls">
            <div class="period-switcher">
                <a href="/?period=daily"
                    class="period-btn {% if current_period == 'daily' %}active{% endif %}">Daily</a>
                <a href="/?period=weekly"
                    class="period-btn {% if current_period == 'weekly' %}active{% endif %}">Weekly</a>
                <a href="/?period=monthly"
                    class="period-btn {% if current_period == 'monthly' %}active{% endif %}">Monthly</a>
            </div>
            <button class="btn btn-primary" onclick="window.openModal('add-task')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Task
            </button>
        </div>
    </header>

    <!-- Stats Overview -->
    <div class="dashboard-stats">
        <div class="stat-card card">
            <div class="stat-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">{{ stats.completed_today }}</div>
                <div class="stat-label">Completed Today</div>
            </div>
        </div>
        <div class="stat-card card">
            <div class="stat-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">{{ stats.pending_today }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>
        <div class="stat-card card">
            <div class="stat-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z">
                    </path>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">{{ stats.current_streak }}</div>
                <div class="stat-label">Day Streak</div>
            </div>
        </div>
        <div class="stat-card card">
            <div class="stat-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">{{ stats.completion_rate }}%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
            <div class="stat-progress">
                <div class="stat-progress-fill" style="width: {{ stats.completion_rate }}%"></div>
            </div>
        </div>
    </div>

    <div class="dashboard-layout">
        <!-- Main Tasks Column -->
        <div class="dashboard-main">
            <div class="section-header">
                <h2 class="section-title">{{ period_title }}</h2>
            </div>

            {% if today_tasks %}
            <div class="dashboard-task-list">
                {% for task in today_tasks %}
                <div class="dashboard-task-item {% if task.status == 'DONE' %}task-done{% endif %}"
                    data-task-id="{{ task.id }}">

                    <!-- Checkbox Button -->
                    <button class="task-checkbox-btn {% if task.status == 'DONE' %}checked{% endif %}"
                        onclick="toggleTask('{{ task.id }}')">
                        {% if task.status == 'DONE' %}
                        <svg class="checkmark" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        {% endif %}
                    </button>

                    <!-- Task Content -->
                    <div class="task-content-area" onclick="window.openModal('edit-task', {task_id: '{{ task.id }}'})">
                        <div class="task-description {% if task.status == 'DONE' %}completed{% endif %}">
                            {{ task.description }}
                        </div>
                        <div class="task-metadata">
                            {% if task.category %}
                            <span class="task-category-badge">{{ task.category }}</span>
                            {% endif %}
                            <span class="task-tracker-label">{{ task.tracker_name }}</span>
                        </div>
                    </div>

                    <!-- Quick Edit Button -->
                    <button class="task-edit-btn"
                        onclick="event.stopPropagation(); window.openModal('edit-task', {task_id: '{{ task.id }}'})">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                        </svg>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="dashboard-empty-state">
                <div class="empty-icon-container">
                    <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                </div>
                <h3 class="empty-title">All done for {{ current_period }}!</h3>
                <p class="empty-description">You've completed all your tasks for this period.</p>
                <button class="btn btn-primary" onclick="window.openModal('add-task')">Add New Task</button>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="dashboard-sidebar">
            <!-- Insights Widget -->
            {% if insights_widget.enabled %}
            <div class="insights-widget card">
                <h3 class="widget-title">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 12h5l3 5 5-11 4 7h3"></path>
                    </svg>
                    Insights
                </h3>
                <div class="insights-list">
                    {% for suggestion in insights_widget.suggestions %}
                    <div class="insight-item">
                        <div class="insight-title">{{ suggestion.title }}</div>
                        <p class="insight-description">{{ suggestion.description }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Active Trackers -->
            <div class="trackers-widget">
                <div class="widget-header">
                    <h3 class="widget-title">Active Trackers</h3>
                    <button class="btn-icon" onclick="window.openModal('add-tracker')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                <div class="trackers-list">
                    {% for tracker in active_trackers %}
                    <a href="/tracker/{{ tracker.id }}/" class="tracker-mini-card">
                        <div class="tracker-header">
                            <h4 class="tracker-name">{{ tracker.name }}</h4>
                            <span class="tracker-period">{{ tracker.time_period }}</span>
                        </div>
                        <div class="tracker-stats">
                            <div class="tracker-progress-value">{{ tracker.progress }}%</div>
                            <div class="tracker-task-count">{{ tracker.completed_count }}/{{ tracker.task_count }}</div>
                        </div>
                        <div class="tracker-progress-bar">
                            <div class="tracker-progress-fill" style="width: {{ tracker.progress }}%"></div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}