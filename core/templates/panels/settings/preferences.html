{% load static %}
<!-- Preferences Settings Panel Content -->
<div class="settings-section" data-section="preferences">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">General Preferences</h2>

    <form id="preferences-form" method="post" action="/api/preferences/">
        {% csrf_token %}

        <!-- Theme Selection -->
        <div class="form-group">
            <label class="form-label">Theme</label>
            <select name="theme" class="form-input">
                {% for theme in themes %}
                <option value="{{ theme.value }}" {% if theme.value==preferences.theme %}selected{% endif %}>
                    {{ theme.label }}
                </option>
                {% endfor %}
            </select>
            <small class="form-help">Choose your preferred color theme</small>
        </div>

        <!-- Start of Week -->
        <div class="form-group">
            <label class="form-label">Start of Week</label>
            <select name="start_of_week" class="form-input">
                <option value="0" {% if preferences.start_of_week==0 %}selected{% endif %}>Monday</option>
                <option value="1" {% if preferences.start_of_week==1 %}selected{% endif %}>Tuesday</option>
                <option value="2" {% if preferences.start_of_week==2 %}selected{% endif %}>Wednesday</option>
                <option value="3" {% if preferences.start_of_week==3 %}selected{% endif %}>Thursday</option>
                <option value="4" {% if preferences.start_of_week==4 %}selected{% endif %}>Friday</option>
                <option value="5" {% if preferences.start_of_week==5 %}selected{% endif %}>Saturday</option>
                <option value="6" {% if preferences.start_of_week==6 %}selected{% endif %}>Sunday</option>
            </select>
        </div>

        <!-- Default View -->
        <div class="form-group">
            <label class="form-label">Default View</label>
            <select name="default_view" class="form-input">
                <option value="dashboard" {% if preferences.default_view=='dashboard' %}selected{% endif %}>Dashboard
                </option>
                <option value="today" {% if preferences.default_view=='today' %}selected{% endif %}>Today</option>
                <option value="week" {% if preferences.default_view=='week' %}selected{% endif %}>Week</option>
                <option value="trackers" {% if preferences.default_view=='trackers' %}selected{% endif %}>Trackers
                </option>
            </select>
            <small class="form-help">The page you see when you open the app</small>
        </div>

        <!-- Toggle Preferences -->
        <div class="form-group">
            <label class="form-label">Notifications</label>

            <label class="toggle-label">
                <input type="checkbox" name="push_enabled" {% if preferences.push_enabled %}checked{% endif %}>
                <span class="toggle-switch"></span>
                <span>Push Notifications</span>
            </label>

            <label class="toggle-label">
                <input type="checkbox" name="email_notifications" {% if preferences.email_notifications %}checked{%
                    endif %}>
                <span class="toggle-switch"></span>
                <span>Email Notifications</span>
            </label>
        </div>

        <!-- Save Button -->
        <button type="submit" class="btn btn-primary">Save Preferences</button>
    </form>
</div>

<style>
    .settings-section {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 12px;
        padding: 2rem;
    }

    .toggle-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        cursor: pointer;
    }

    .toggle-switch {
        position: relative;
        width: 44px;
        height: 24px;
        background: var(--color-bg);
        border-radius: 12px;
        transition: background 0.2s;
    }

    .toggle-switch::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: transform 0.2s;
    }

    .toggle-label input:checked+.toggle-switch {
        background: var(--color-primary);
    }

    .toggle-label input:checked+.toggle-switch::after {
        transform: translateX(20px);
    }

    .toggle-label input {
        position: absolute;
        opacity: 0;
    }
</style>

<script>
    document.getElementById('preferences-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);

        try {
            const response = await fetch('/api/preferences/', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                showToast('Preferences saved successfully', 'success');

                // Apply theme immediately
                const theme = formData.get('theme');
                if (theme) {
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('tracker-theme', theme);
                }
            } else {
                showToast(data.error || 'Failed to save preferences', 'error');
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });
</script>