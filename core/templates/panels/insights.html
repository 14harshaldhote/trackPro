{% load static %}
<div class="panel" data-panel="insights">
    <div class="breadcrumb">
        <a href="/">Home</a>
        <span class="breadcrumb-separator">â€º</span>
        <span>Insights</span>
    </div>

    <div class="panel-header">
        <h1 class="panel-title">ğŸ§  Behavioral Insights</h1>
        <p style="color: var(--color-text-secondary); margin: 0.5rem 0 0;">
            Discover patterns in your productivity
        </p>
    </div>

    <!-- Productivity Score -->
    <div
        style="background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; color: white;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-size: 3rem; font-weight: 700; margin-bottom: 0.5rem;">{{ productivity_score }}</div>
                <div style="font-size: 1.125rem; opacity: 0.9;">Productivity Score</div>
                <div style="font-size: 0.875rem; opacity: 0.7; margin-top: 0.25rem;">
                    {% if productivity_score >= 80 %}ğŸ”¥ Excellent!
                    {% elif productivity_score >= 60 %}ğŸ‘ Good job!
                    {% elif productivity_score >= 40 %}ğŸ’ª Keep going!
                    {% else %}ğŸŒ± Room to grow{% endif %}
                </div>
            </div>
            <div style="width: 120px; height: 120px;">
                <svg viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="8" />
                    <circle cx="60" cy="60" r="54" fill="none" stroke="white" stroke-width="8"
                        stroke-dasharray="{{ productivity_score|floatformat:0|add:'0' }} 340" stroke-dashoffset="85"
                        transform="rotate(-90 60 60)" stroke-linecap="round" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Pattern Analysis -->
    {% if patterns %}
    <section style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ“ˆ Your Patterns</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div class="stat-card">
                <div style="font-size: 1rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">Best Day</div>
                <div style="font-size: 1.75rem; font-weight: 700; color: var(--color-primary);">{{ patterns.best_day }}
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-tertiary); margin-top: 0.25rem;">Highest
                    completion rate</div>
            </div>

            <div class="stat-card">
                <div style="font-size: 1rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">Best Time</div>
                <div style="font-size: 1.75rem; font-weight: 700; color: var(--color-primary);">
                    {% if patterns.best_time == 'morning' %}ğŸŒ… Morning
                    {% elif patterns.best_time == 'afternoon' %}â˜€ï¸ Afternoon
                    {% elif patterns.best_time == 'evening' %}ğŸŒ™ Evening
                    {% else %}N/A{% endif %}
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-tertiary); margin-top: 0.25rem;">Most
                    productive time</div>
            </div>

            <div class="stat-card">
                <div style="font-size: 1rem; color: var(--color-text-secondary); margin-bottom: 0.5rem;">Consistency
                </div>
                <div style="font-size: 1.75rem; font-weight: 700; color: var(--color-primary);">{{
                    patterns.consistency_score }}/100</div>
                <div style="font-size: 0.875rem; color: var(--color-text-tertiary); margin-top: 0.25rem;">How consistent
                    you are</div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Actionable Recommendations -->
    {% if recommendations %}
    <section style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ’¡ Recommendations</h2>

        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for rec in recommendations %}
            <div
                style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; padding: 1.5rem;">
                <div style="display: flex; gap: 1rem;">
                    <div style="font-size: 2rem; flex-shrink: 0;">{{ rec.icon|default:"ğŸ’¡" }}</div>
                    <div style="flex: 1;">
                        <h3 style="font-weight: 600; margin: 0 0 0.5rem;">{{ rec.title }}</h3>
                        <p style="color: var(--color-text-secondary); margin: 0 0 1rem; font-size: 0.875rem;">
                            {{ rec.description }}
                        </p>
                        {% if rec.action %}
                        <button class="btn btn-sm btn-primary" data-action="{{ rec.action }}">
                            {{ rec.action_label|default:"Take Action" }}
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- All Insights -->
    {% if insights %}
    <section>
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ğŸ” All Insights</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;">
            {% for insight in insights %}
            <div
                style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <div style="font-size: 2rem;">{{ insight.icon|default:"ğŸ“Š" }}</div>
                    <h3 style="font-weight: 600; margin: 0;">{{ insight.title }}</h3>
                </div>
                <p style="color: var(--color-text-secondary); margin: 0; font-size: 0.875rem;">
                    {{ insight.description }}
                </p>
                {% if insight.metric %}
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border);">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary);">{{ insight.metric }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--color-text-tertiary);">{{ insight.metric_label }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <div class="empty-state">
        <svg class="empty-state-icon" width="80" height="80" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
            <path fill-rule="evenodd"
                d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"
                clip-rule="evenodd" />
        </svg>
        <h3 class="empty-state-title">Not enough data yet</h3>
        <p class="empty-state-description">
            Keep tracking your tasks to unlock behavioral insights and personalized recommendations
        </p>
        <a href="/today/" class="btn btn-primary">Start Tracking</a>
    </div>
    {% endif %}
</div>