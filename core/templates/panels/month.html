{% extends 'base.html' %}

{% block content %}
<div class="panel fade-in">
    <header class="panel-header mb-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold">{{ month_name }} {{ year }}</h1>
        <div class="flex items-center gap-2 bg-surface rounded-lg p-1 border border-border">
            <a href="/month/?month={{ prev_month|date:'Y-m' }}" class="btn-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                </button>
                <span class="text-sm font-medium px-4">
                    {{ month_stats.total_days }} days
                </span>
                <a href="/month/?month={{ next_month|date:'Y-m' }}" class="btn-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    </button>
        </div>
    </header>

    <!-- Month Stats -->
    <div class="grid-responsive mb-6">
        <div class="card stat-card">
            <div class="stat-value">{{ month_stats.completed }}/{{ month_stats.total }}</div>
            <div class="stat-label">Total Completed</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value">{{ month_stats.completion_rate }}%</div>
            <div class="stat-label">Completion Rate</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value">{{ month_stats.productive_days }}</div>
            <div class="stat-label">Productive Days</div>
            <div class="text-[10px] text-secondary mt-1">>80% tasks done</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value">{{ month_stats.best_week|default:"-" }}</div>
            <div class="stat-label">Best Week</div>
        </div>
    </div>

    <!-- Month Calendar -->
    <div class="card p-4 overflow-hidden">
        <!-- Weekday Headers -->
        <div class="grid grid-cols-7 mb-2 border-b border-border pb-2 text-center text-sm font-bold text-secondary">
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
            <div>Sun</div>
        </div>

        <!-- Days Grid -->
        <div class="grid grid-cols-7 gap-1">
            {% for week in calendar_weeks %}
            {% for day in week %}
            <div class="relative aspect-square p-1 {% if not day.date %}opacity-0 pointer-events-none{% endif %}">
                {% if day.date %}
                <a href="/today/?date={{ day.date|date:'Y-m-d' }}"
                    title="{{ day.date|date:'Y-m-d' }}: {{ day.completion_rate }}% complete">

                    <div class="flex justify-between items-start p-1">
                        <span class="text-xs font-medium {% if day.is_today %}text-primary{% endif %}">
                            {{ day.day }}
                        </span>
                        {% if day.has_tasks %}
                        <div class="w-2 h-2 rounded-full"
                            style="background-color: {% if day.completion_rate >= 80 %}var(--color-success){% elif day.completion_rate >= 50 %}var(--color-warning){% else %}var(--color-error){% endif %}">
                        </div>
                        {% endif %}
                    </div>

                    <!-- Mini Heatmap/Progress -->
                    <div class="absolute bottom-1 left-1 right-1 h-1 bg-border/30 rounded overflow-hidden">
                        <div class="h-full bg-primary" style="width: {{ day.completion_rate }}%"></div>
                    </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% endfor %}
    </div>
</div>
</div>

<style>
    .aspect-square {
        aspect-ratio: 1 / 1;
    }

    .grid-cols-7 {
        grid-template-columns: repeat(7, 1fr);
    }
</style>
{% endblock %}