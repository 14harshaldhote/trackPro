{% load static %}
<div class="panel" data-panel="tracker-detail">
    <div class="breadcrumb">
        <a href="/">Home</a>
        <span class="breadcrumb-separator">â€º</span>
        <a href="/trackers/">Trackers</a>
        <span class="breadcrumb-separator">â€º</span>
        <span>{{ tracker.name }}</span>
    </div>

    <div class="panel-header">
        <div>
            <h1 class="panel-title">{{ tracker.name }}</h1>
            {% if tracker.description %}
            <p style="color: var(--color-text-secondary); margin: 0.5rem 0 0;">{{ tracker.description }}</p>
            {% endif %}
        </div>

        <div class="panel-actions">
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
                    </svg>
                    Options
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" data-action="edit-tracker">Edit Tracker</button>
                    <button class="dropdown-item" data-action="export-tracker">Export Data</button>
                    <button class="dropdown-item" data-action="share-tracker">Share</button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" data-action="pause-tracker">
                        {% if tracker.status == 'paused' %}Resume{% else %}Pause{% endif %} Tracker
                    </button>
                    <button class="dropdown-item dropdown-item-danger" data-action="delete-tracker">Delete
                        Tracker</button>
                </div>
            </div>
            <button class="btn btn-primary" data-action="add-task" data-tracker-id="{{ tracker.tracker_id }}">Add
                Task</button>
        </div>
    </div>

    <!-- Quick Stats -->
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="stat-card">
            <div class="stat-value">{{ progress }}%</div>
            <div class="stat-label">Overall Progress</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ completed_count }}/{{ task_count }}</div>
            <div class="stat-label">Tasks Completed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ tracker.time_period|title }}</div>
            <div class="stat-label">Time Period</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.current_streak|default:0 }}</div>
            <div class="stat-label">Current Streak</div>
        </div>
    </div>

    <!-- Today's Tasks -->
    <section style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Today's Tasks</h2>

        {% if today_tasks %}
        <div class="task-list">
            {% for task in today_tasks %}
            <div class="task-item" data-task-id="{{ task.task_instance_id }}">
                <label class="task-checkbox">
                    <input type="checkbox" {% if task.status=='DONE' %}checked{% endif %}>
                    <span class="checkbox-mark"></span>
                </label>
                <div class="task-content">
                    <div class="task-description">{{ task.template.description }}</div>
                    <div class="task-meta">
                        {% if task.template.category %}
                        <span>{{ task.template.category }}</span>
                        {% endif %}
                        <span>Weight: {{ task.template.weight }}</span>
                    </div>
                </div>
                <button class="btn-icon" data-action="edit-task" data-task-id="{{ task.task_instance_id }}">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                    </svg>
                </button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="padding: 2rem; text-align: center; background: var(--color-bg); border-radius: 12px;">
            <p style="color: var(--color-text-secondary); margin: 0;">No tasks for today</p>
        </div>
        {% endif %}
    </section>

    <!-- Task Groups by Status -->
    <section style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">All Tasks</h2>

        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
            <button class="btn btn-sm {% if group_by == 'status' %}btn-primary{% else %}btn-secondary{% endif %}"
                data-filter="status">By Status</button>
            <button class="btn btn-sm {% if group_by == 'date' %}btn-primary{% else %}btn-secondary{% endif %}"
                data-filter="date">By Date</button>
            <button class="btn btn-sm {% if group_by == 'category' %}btn-primary{% else %}btn-secondary{% endif %}"
                data-filter="category">By Category</button>
        </div>

        {% if grouped_tasks %}
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
            {% if grouped_tasks.todo %}
            <div>
                <h3
                    style="font-size: 0.875rem; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 0.75rem; text-transform: uppercase;">
                    To Do ({{ grouped_tasks.todo|length }})
                </h3>
                <div class="task-list">
                    {% for task in grouped_tasks.todo %}
                    <div class="task-item" data-task-id="{{ task.task_instance_id }}">
                        <label class="task-checkbox">
                            <input type="checkbox">
                            <span class="checkbox-mark"></span>
                        </label>
                        <div class="task-content">
                            <div class="task-description">{{ task.template.description }}</div>
                            <div class="task-meta">
                                <span>{{ task.created_at|date:"M d" }}</span>
                                {% if task.template.category %}
                                <span>{{ task.template.category }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <button class="btn-icon" data-action="edit-task">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                            </svg>
                        </button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if grouped_tasks.done %}
            <div>
                <h3
                    style="font-size: 0.875rem; font-weight: 600; color: var(--color-success); margin-bottom: 0.75rem; text-transform: uppercase;">
                    Done ({{ grouped_tasks.done|length }})
                </h3>
                <div class="task-list">
                    {% for task in grouped_tasks.done|slice:":5" %}
                    <div class="task-item" data-task-id="{{ task.task_instance_id }}" style="opacity: 0.7;">
                        <label class="task-checkbox">
                            <input type="checkbox" checked>
                            <span class="checkbox-mark"></span>
                        </label>
                        <div class="task-content">
                            <div class="task-description" style="text-decoration: line-through;">{{
                                task.template.description }}</div>
                        </div>
                    </div>
                    {% endfor %}
                    {% if grouped_tasks.done|length > 5 %}
                    <button class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 0.5rem;">
                        Show {{ grouped_tasks.done|length|add:"-5" }} more
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </section>

    <!-- 7-Day Metrics -->
    {% if detailed_metrics %}
    <section
        style="background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 1.5rem;">
        <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">ðŸ“Š Last 7 Days</h2>

        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem;">
            {% for day in detailed_metrics %}
            <div style="text-align: center;">
                <div style="font-size: 0.75rem; color: var(--color-text-tertiary); margin-bottom: 0.25rem;">{{
                    day.date|date:"D" }}</div>
                <div style="height: 80px; display: flex; flex-direction: column; justify-content: flex-end;">
                    <div
                        style="height: {{ day.completion_rate }}%; background: var(--color-primary); border-radius: 4px 4px 0 0;">
                    </div>
                </div>
                <div style="font-size: 0.75rem; font-weight: 600; margin-top: 0.25rem;">{{ day.completion_rate }}%</div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>