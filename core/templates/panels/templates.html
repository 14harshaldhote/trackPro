<!-- Templates Library Panel -->
<div class="panel templates-panel fade-in">
    <div class="panel-header">
        <div>
            <h1 class="panel-title">Templates Library</h1>
            <p class="panel-subtitle">Ready-to-use tracker templates</p>
        </div>
        <div class="panel-actions">
            <button class="btn btn-primary" data-action="create-template">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Create Template
            </button>
        </div>
    </div>

    <!-- Template Categories -->
    <div class="template-categories">
        <button class="category-btn active" data-category="all">All</button>
        <button class="category-btn" data-category="health">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
            </svg>
            Health
        </button>
        <button class="category-btn" data-category="productivity">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Productivity
        </button>
        <button class="category-btn" data-category="learning">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
            Learning
        </button>
        <button class="category-btn" data-category="lifestyle">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                </polygon>
            </svg>
            Lifestyle
        </button>
    </div>

    <!-- Templates Grid -->
    <div class="templates-grid">
        <!-- Morning Routine -->
        <div class="template-card" data-category="lifestyle">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v8"></path>
                    <path d="m4.93 10.93 1.41 1.41"></path>
                    <path d="M2 18h2"></path>
                    <path d="M20 18h2"></path>
                    <path d="m19.07 10.93-1.41 1.41"></path>
                    <path d="M22 22H2"></path>
                    <path d="m8 22 4-10 4 10"></path>
                </svg>
            </div>
            <h3 class="template-name">Morning Routine</h3>
            <p class="template-description">Start your day with purpose. Includes meditation, exercise, and planning.
            </p>
            <div class="template-tasks">
                <span class="task-count">8 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="morning">Use Template</button>
        </div>

        <!-- Fitness Tracker -->
        <div class="template-card" data-category="health">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>
            </div>
            <h3 class="template-name">Fitness Tracker</h3>
            <p class="template-description">Track workouts, nutrition, and recovery for optimal fitness.</p>
            <div class="template-tasks">
                <span class="task-count">6 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="fitness">Use Template</button>
        </div>

        <!-- Study Plan -->
        <div class="template-card" data-category="learning">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
            </div>
            <h3 class="template-name">Study Plan</h3>
            <p class="template-description">Structured learning with reading, practice, and review sessions.</p>
            <div class="template-tasks">
                <span class="task-count">5 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="study">Use Template</button>
        </div>

        <!-- Work Productivity -->
        <div class="template-card" data-category="productivity">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="6"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                </svg>
            </div>
            <h3 class="template-name">Work Productivity</h3>
            <p class="template-description">Focus blocks, email management, and daily planning.</p>
            <div class="template-tasks">
                <span class="task-count">7 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="work">Use Template</button>
        </div>

        <!-- Mindfulness -->
        <div class="template-card" data-category="health">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                </svg>
            </div>
            <h3 class="template-name">Mindfulness</h3>
            <p class="template-description">Meditation, gratitude journaling, and mental wellness.</p>
            <div class="template-tasks">
                <span class="task-count">4 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="mindfulness">Use Template</button>
        </div>

        <!-- Evening Wind Down -->
        <div class="template-card" data-category="lifestyle">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </div>
            <h3 class="template-name">Evening Wind Down</h3>
            <p class="template-description">Prepare for restful sleep with relaxation routines.</p>
            <div class="template-tasks">
                <span class="task-count">5 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="evening">Use Template</button>
        </div>

        <!-- Weekly Review -->
        <div class="template-card" data-category="productivity">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="20" x2="12" y2="10"></line>
                    <line x1="18" y1="20" x2="18" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="16"></line>
                </svg>
            </div>
            <h3 class="template-name">Weekly Review</h3>
            <p class="template-description">Reflect on the week and plan for success ahead.</p>
            <div class="template-tasks">
                <span class="task-count">6 tasks</span>
                <span class="template-type">Weekly</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="weekly-review">Use
                Template</button>
        </div>

        <!-- Language Learning -->
        <div class="template-card" data-category="learning">
            <div class="template-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                    </path>
                </svg>
            </div>
            <h3 class="template-name">Language Learning</h3>
            <p class="template-description">Vocabulary, grammar, speaking practice, and immersion.</p>
            <div class="template-tasks">
                <span class="task-count">5 tasks</span>
                <span class="template-type">Daily</span>
            </div>
            <button class="btn btn-primary" data-action="use-template" data-template="language">Use Template</button>
        </div>
    </div>
</div>

<script>
    (function initTemplatesPanel() {
        'use strict';

        // Template category filtering
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active button
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const category = btn.dataset.category;

                // Filter template cards
                document.querySelectorAll('.template-card').forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

        // Template activation
        document.querySelectorAll('[data-action="use-template"]').forEach(btn => {
            btn.addEventListener('click', async () => {
                const templateName = btn.dataset.template;
                const card = btn.closest('.template-card');
                const templateTitle = card?.querySelector('.template-name')?.textContent || templateName;

                btn.disabled = true;
                btn.textContent = 'Creating...';

                try {
                    const result = await window.apiClient.post('/templates/activate/', {
                        template_key: templateName
                    });

                    if (window.App) {
                        window.App.showToast('success', `"${templateTitle}" tracker created!`);
                        // Navigate to the new tracker
                        if (result.tracker_id) {
                            window.App.loadPanel(`/tracker/${result.tracker_id}/`);
                        } else {
                            window.App.loadPanel('/trackers/');
                        }
                    }
                } catch (error) {
                    console.error('[Templates] Activation failed:', error);
                    if (window.App) {
                        window.App.showToast('error', 'Failed to create tracker', error.message);
                    }
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'Use Template';
                }
            });
        });

        console.log('[TemplatesPanel] Initialized');
    })();
</script>