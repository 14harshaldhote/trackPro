<!-- Confirm Delete Modal -->
<div class="modal-dialog modal-sm" role="document">
    <div class="modal-header">
        <h3 class="modal-title">Confirm Delete</h3>
        <button type="button" class="modal-close" data-action="close-modal" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <div class="modal-body" style="text-align: center;">
        <div class="delete-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
        </div>

        <h4 id="delete-title">Are you sure?</h4>
        <p id="delete-message" class="delete-message">
            This action cannot be undone. All associated data will be permanently deleted.
        </p>
    </div>

    <div class="modal-footer" style="justify-content: center;">
        <button type="button" class="btn btn-ghost" data-action="close-modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-btn">
            Delete
        </button>
    </div>
</div>

<style>
    .modal-sm {
        max-width: 360px;
    }

    .delete-icon {
        margin-bottom: 1rem;
    }

    .delete-message {
        color: var(--color-text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
    }

    .btn-danger {
        background: #EF4444;
        color: white;
    }

    .btn-danger:hover {
        background: #DC2626;
        transform: translateY(-2px);
    }
</style>

<script>
    // This modal expects these to be set by the opener:
    // window.deleteConfig = { url: '/api/...', onSuccess: () => {} }
    document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        const config = window.deleteConfig || {};
        const btn = document.getElementById('confirm-delete-btn');

        if (!config.url) {
            console.error('Delete URL not configured');
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> Deleting...';

        try {
            const response = await fetch(config.url, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': window.TrackerPro?.csrfToken || '',
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok && data.success) {
                App.showToast('success', 'Deleted successfully');
                App.closeModal();

                if (typeof config.onSuccess === 'function') {
                    config.onSuccess(data);
                } else if (data.redirect) {
                    App.loadPanel(data.redirect);
                }
            } else {
                App.showToast('error', 'Delete failed', data.error || 'Unknown error');
            }
        } catch (error) {
            App.showToast('error', 'Delete failed', error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'Delete';
        }
    });
</script>