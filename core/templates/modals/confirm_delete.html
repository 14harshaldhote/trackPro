<!-- Confirm Delete Modal -->
<div class="modal-dialog modal-sm">
    <div class="modal-header">
        <h2 class="modal-title">⚠️ Confirm Deletion</h2>
        <button class="modal-close" data-action="close-modal" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                    clip-rule="evenodd" />
            </svg>
        </button>
    </div>

    <div class="modal-body">
        <p style="margin: 0 0 1rem;">
            Are you sure you want to delete <strong id="delete-item-name">this item</strong>?
        </p>

        <div style="padding: 1rem; background: var(--color-error-bg); border-radius: 8px; margin-bottom: 1rem;">
            <p style="margin: 0; font-size: 0.875rem; color: var(--color-error);">
                ⚠️ This action cannot be undone. All data associated with this item will be permanently deleted.
            </p>
        </div>

        <div class="form-group" id="confirmation-input-group" style="display: none;">
            <label for="confirm-text" class="form-label">
                Type <code>DELETE</code> to confirm:
            </label>
            <input type="text" id="confirm-text" class="form-input" placeholder="DELETE" autocomplete="off">
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
        <button class="btn btn-danger" id="confirm-delete-btn" disabled>Delete</button>
    </div>
</div>

<style>
    .btn-danger {
        background: var(--color-error);
        border-color: var(--color-error);
        color: white;
    }

    .btn-danger:hover:not(:disabled) {
        background: var(--color-error-dark);
    }

    .btn-danger:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>

<script>
    // Modal data will be set by the calling code
    window.confirmDeleteData = {
        itemType: 'item',
        itemName: 'this item',
        itemId: null,
        endpoint: null,
        requiresConfirmation: false
    };

    // Update UI based on data
    function initConfirmDelete() {
        const data = window.confirmDeleteData;

        document.getElementById('delete-item-name').textContent = data.itemName;

        if (data.requiresConfirmation) {
            document.getElementById('confirmation-input-group').style.display = 'block';

            document.getElementById('confirm-text').addEventListener('input', (e) => {
                const btn = document.getElementById('confirm-delete-btn');
                btn.disabled = e.target.value !== 'DELETE';
            });
        } else {
            document.getElementById('confirm-delete-btn').disabled = false;
        }
    }

    document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        const data = window.confirmDeleteData;

        if (!data.endpoint) {
            showToast('Invalid delete configuration', 'error');
            return;
        }

        try {
            const response = await fetch(data.endpoint, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            });

            const result = await response.json();

            if (result.success) {
                document.querySelector('[data-action="close-modal"]').click();
                showToast(result.message || 'Deleted successfully', 'success');

                // Reload current panel
                if (window.loadCurrentPanel) {
                    window.loadCurrentPanel();
                }
            } else {
                showToast(result.error || 'Failed to delete', 'error');
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });

    // Initialize when modal opens
    setTimeout(initConfirmDelete, 100);
</script>