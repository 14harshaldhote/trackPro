<!-- Image Preview Modal -->
<div class="modal-header image-preview-header">
    <h2 class="modal-title">{{ image_title|default:"Image" }}</h2>
    <div class="image-preview-actions">
        <a href="{{ image_url }}" download class="btn btn-icon" title="Download">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        </a>
        <button type="button" class="btn btn-icon" data-action="close-modal" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
</div>

<div class="modal-body image-preview-body">
    <div class="image-container">
        <img src="{{ image_url }}" alt="{{ image_title|default:'Preview' }}" id="preview-image">
    </div>

    <!-- Zoom Controls -->
    <div class="image-controls">
        <button type="button" class="btn btn-icon" id="zoom-out" title="Zoom Out">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
        </button>
        <span id="zoom-level">100%</span>
        <button type="button" class="btn btn-icon" id="zoom-in" title="Zoom In">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="11" y1="8" x2="11" y2="14"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
        </button>
        <button type="button" class="btn btn-icon" id="zoom-reset" title="Reset">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
        </button>
    </div>
</div>

<script>
    (function () {
        const img = document.getElementById('preview-image');
        const zoomLevel = document.getElementById('zoom-level');
        let scale = 1;

        function setZoom(newScale) {
            scale = Math.max(0.25, Math.min(3, newScale));
            img.style.transform = `scale(${scale})`;
            zoomLevel.textContent = `${Math.round(scale * 100)}%`;
        }

        document.getElementById('zoom-in').addEventListener('click', () => setZoom(scale + 0.25));
        document.getElementById('zoom-out').addEventListener('click', () => setZoom(scale - 0.25));
        document.getElementById('zoom-reset').addEventListener('click', () => setZoom(1));

        // Mouse wheel zoom
        img.addEventListener('wheel', (e) => {
            e.preventDefault();
            setZoom(scale + (e.deltaY > 0 ? -0.1 : 0.1));
        });
    })();
</script>