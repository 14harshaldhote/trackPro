<!-- Share Tracker Modal -->
<div class="modal-header">
    <h2 class="modal-title">Share Tracker</h2>
    <button type="button" class="btn btn-icon" data-action="close-modal" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>
</div>

<div class="modal-body">
    <p class="text-muted mb-4">Share this tracker with others using a link or email invitation.</p>

    <!-- Share Link -->
    <div class="share-section">
        <h4>Share Link</h4>
        <div class="share-link-input">
            <input type="text" id="share-url" class="form-input" readonly value="Generating link..."
                placeholder="Share link">
            <button type="button" class="btn btn-primary" id="copy-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
            </button>
        </div>
        <p class="text-muted text-sm mt-2">Anyone with this link can view your tracker (read-only).</p>
    </div>

    <div class="divider">
        <span>or</span>
    </div>

    <!-- Email Invitation -->
    <div class="share-section">
        <h4>Invite by Email</h4>
        <form id="share-email-form">
            <div class="form-group">
                <input type="email" name="email" class="form-input" placeholder="Enter email address" required>
            </div>
            <div class="form-group">
                <select name="permission" class="form-select">
                    <option value="view">Can view</option>
                    <option value="edit">Can edit</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-full">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13"></path>
                    <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                </svg>
                Send Invitation
            </button>
        </form>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-ghost" data-action="close-modal">Done</button>
</div>

<script>
    (function () {
        const trackerId = '{{ tracker_id }}';
        const shareUrl = document.getElementById('share-url');
        const copyBtn = document.getElementById('copy-link');

        // Generate share link
        fetch(`/api/tracker/${trackerId}/share/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': App.getCsrfToken()
            }
        })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    shareUrl.value = data.share_url;
                }
            });

        // Copy link
        copyBtn.addEventListener('click', async () => {
            await navigator.clipboard.writeText(shareUrl.value);
            copyBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!`;
            setTimeout(() => {
                copyBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy`;
            }, 2000);
        });
    })();
</script>