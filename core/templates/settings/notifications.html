{% load static %}
<!-- Notification Settings Panel Content -->
<div class="settings-section" data-section="notifications">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Notification Settings</h2>

    <form id="notifications-form" method="post">
        {% csrf_token %}

        <!-- Push Notifications -->
        <section style="margin-bottom: 2rem;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Push Notifications</h3>

            <label class="toggle-label">
                <input type="checkbox" name="push_enabled" {% if preferences.push_enabled %}checked{% endif %}>
                <span class="toggle-switch"></span>
                <span>Enable push notifications</span>
            </label>

            <div id="push-settings"
                style="margin-top: 1rem; {% if not preferences.push_enabled %}opacity: 0.5; pointer-events: none;{% endif %}">
                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="push_task_reminders" {% if preferences.push_task_reminders %}checked{%
                        endif %}>
                    <span class="toggle-switch"></span>
                    <span>Task reminders</span>
                </label>

                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="push_streak_milestones" {% if preferences.push_streak_milestones
                        %}checked{% endif %}>
                    <span class="toggle-switch"></span>
                    <span>Streak milestones</span>
                </label>

                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="push_goal_progress" {% if preferences.push_goal_progress %}checked{%
                        endif %}>
                    <span class="toggle-switch"></span>
                    <span>Goal progress updates</span>
                </label>

                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="push_daily_summary" {% if preferences.push_daily_summary %}checked{%
                        endif %}>
                    <span class="toggle-switch"></span>
                    <span>Daily summary</span>
                </label>
            </div>
        </section>

        <!-- Email Notifications -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Email Notifications</h3>

            <label class="toggle-label">
                <input type="checkbox" name="email_enabled" {% if preferences.email_notifications %}checked{% endif %}>
                <span class="toggle-switch"></span>
                <span>Enable email notifications</span>
            </label>

            <div id="email-settings"
                style="margin-top: 1rem; {% if not preferences.email_notifications %}opacity: 0.5; pointer-events: none;{% endif %}">
                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="email_weekly_summary" {% if preferences.email_weekly_summary
                        %}checked{% endif %}>
                    <span class="toggle-switch"></span>
                    <span>Weekly summary report</span>
                </label>

                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="email_goal_achieved" {% if preferences.email_goal_achieved %}checked{%
                        endif %}>
                    <span class="toggle-switch"></span>
                    <span>Goal achievement</span>
                </label>

                <label class="toggle-label" style="margin-left: 2rem;">
                    <input type="checkbox" name="email_product_updates" {% if preferences.email_product_updates
                        %}checked{% endif %}>
                    <span class="toggle-switch"></span>
                    <span>Product updates and tips</span>
                </label>
            </div>
        </section>

        <!-- Quiet Hours -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Quiet Hours</h3>
            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 1rem;">
                Disable notifications during these hours
            </p>

            <label class="toggle-label" style="margin-bottom: 1rem;">
                <input type="checkbox" name="quiet_hours_enabled" {% if preferences.quiet_hours_enabled %}checked{%
                    endif %}>
                <span class="toggle-switch"></span>
                <span>Enable quiet hours</span>
            </label>

            <div id="quiet-hours-settings"
                style="{% if not preferences.quiet_hours_enabled %}opacity: 0.5; pointer-events: none;{% endif %}">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 400px;">
                    <div class="form-group">
                        <label for="quiet_start" class="form-label">Start Time</label>
                        <input type="time" id="quiet_start" name="quiet_start" class="form-input"
                            value="{{ preferences.quiet_start|default:'22:00' }}">
                    </div>

                    <div class="form-group">
                        <label for="quiet_end" class="form-label">End Time</label>
                        <input type="time" id="quiet_end" name="quiet_end" class="form-input"
                            value="{{ preferences.quiet_end|default:'08:00' }}">
                    </div>
                </div>
            </div>
        </section>

        <!-- Notification Frequency -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Notification Frequency</h3>

            <div class="form-group">
                <label for="notification_frequency" class="form-label">How often should we notify you about incomplete
                    tasks?</label>
                <select id="notification_frequency" name="notification_frequency" class="form-input">
                    <option value="never" {% if preferences.notification_frequency=='never' %}selected{% endif %}>Never
                    </option>
                    <option value="once" {% if preferences.notification_frequency=='once' %}selected{% endif %}>Once per
                        day</option>
                    <option value="twice" {% if preferences.notification_frequency=='twice' %}selected{% endif %}>Twice
                        per day</option>
                    <option value="hourly" {% if preferences.notification_frequency=='hourly' %}selected{% endif %}>
                        Every hour</option>
                </select>
            </div>
        </section>

        <button type="submit" class="btn btn-primary">Save Notification Settings</button>
    </form>
</div>

<script>
    // Toggle dependent settings
    document.querySelector('[name="push_enabled"]').addEventListener('change', (e) => {
        const settings = document.getElementById('push-settings');
        if (e.target.checked) {
            settings.style.opacity = '1';
            settings.style.pointerEvents = 'auto';
        } else {
            settings.style.opacity = '0.5';
            settings.style.pointerEvents = 'none';
        }
    });

    document.querySelector('[name="email_enabled"]').addEventListener('change', (e) => {
        const settings = document.getElementById('email-settings');
        if (e.target.checked) {
            settings.style.opacity = '1';
            settings.style.pointerEvents = 'auto';
        } else {
            settings.style.opacity = '0.5';
            settings.style.pointerEvents = 'none';
        }
    });

    document.querySelector('[name="quiet_hours_enabled"]').addEventListener('change', (e) => {
        const settings = document.getElementById('quiet-hours-settings');
        if (e.target.checked) {
            settings.style.opacity = '1';
            settings.style.pointerEvents = 'auto';
        } else {
            settings.style.opacity = '0.5';
            settings.style.pointerEvents = 'none';
        }
    });

    // Form submission
    document.getElementById('notifications-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);

        try {
            const response = await fetch('/api/preferences/notifications/', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                showToast('Notification settings saved', 'success');
            } else {
                showToast(data.error || 'Failed to save settings', 'error');
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });
</script>