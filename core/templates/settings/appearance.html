{% load static %}
<!-- Appearance Settings Panel Content -->
<div class="settings-section" data-section="appearance">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Appearance Settings</h2>

    <form id="appearance-form" method="post">
        {% csrf_token %}

        <!-- Theme Selection -->
        <section style="margin-bottom: 2rem;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Color Theme</h3>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem;">
                {% for theme in themes %}
                <div class="theme-option {% if theme.value == preferences.theme %}theme-selected{% endif %}"
                    data-theme="{{ theme.value }}"
                    style="cursor: pointer; padding: 1rem; border: 2px solid var(--color-border); border-radius: 12px; transition: all 0.2s;">
                    <div
                        style="height: 60px; background: linear-gradient(135deg, {{ theme.primary }} 0%, {{ theme.secondary }} 100%); border-radius: 8px; margin-bottom: 0.5rem;">
                    </div>
                    <div style="font-size: 0.875rem; font-weight: 600; text-align: center;">{{ theme.name }}</div>
                </div>
                {% endfor %}
            </div>
            <input type="hidden" name="theme" id="theme-input" value="{{ preferences.theme }}">
        </section>

        <!-- UI Density -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">UI Density</h3>
            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 1rem;">
                Control how compact the interface appears
            </p>

            <div class="form-group">
                <select name="ui_density" class="form-input">
                    <option value="comfortable" {% if preferences.ui_density=='comfortable' %}selected{% endif %}>
                        Comfortable (Default)</option>
                    <option value="compact" {% if preferences.ui_density=='compact' %}selected{% endif %}>Compact
                    </option>
                    <option value="spacious" {% if preferences.ui_density=='spacious' %}selected{% endif %}>Spacious
                    </option>
                </select>
            </div>
        </section>

        <!-- Font Size -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Font Size</h3>

            <div class="form-group">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-size: 0.875rem;">A</span>
                    <input type="range" id="font-size" name="font_size" class="form-range" min="12" max="18"
                        value="{{ preferences.font_size|default:14 }}" style="flex: 1;">
                    <span style="font-size: 1.25rem;">A</span>
                    <span id="font-size-value" style="min-width: 3rem; text-align: center; font-weight: 600;">{{
                        preferences.font_size|default:14 }}px</span>
                </div>
            </div>
        </section>

        <!-- Animations -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Animations & Effects</h3>

            <label class="toggle-label">
                <input type="checkbox" name="animations_enabled" {% if preferences.animations_enabled %}checked{% endif
                    %}>
                <span class="toggle-switch"></span>
                <span>Enable animations</span>
            </label>

            <label class="toggle-label">
                <input type="checkbox" name="celebration_effects" {% if preferences.celebration_effects %}checked{%
                    endif %}>
                <span class="toggle-switch"></span>
                <span>Celebration effects (confetti, etc.)</span>
            </label>

            <label class="toggle-label">
                <input type="checkbox" name="reduced_motion" {% if preferences.reduced_motion %}checked{% endif %}>
                <span class="toggle-switch"></span>
                <span>Reduce motion (accessibility)</span>
            </label>
        </section>

        <!-- Sidebar -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Sidebar</h3>

            <div class="form-group">
                <label for="sidebar_position" class="form-label">Position</label>
                <select name="sidebar_position" class="form-input">
                    <option value="left" {% if preferences.sidebar_position=='left' %}selected{% endif %}>Left</option>
                    <option value="right" {% if preferences.sidebar_position=='right' %}selected{% endif %}>Right
                    </option>
                </select>
            </div>

            <label class="toggle-label">
                <input type="checkbox" name="sidebar_collapsed" {% if preferences.sidebar_collapsed %}checked{% endif
                    %}>
                <span class="toggle-switch"></span>
                <span>Collapsed by default</span>
            </label>

            <label class="toggle-label">
                <input type="checkbox" name="show_tracker_icons" {% if preferences.show_tracker_icons %}checked{% endif
                    %}>
                <span class="toggle-switch"></span>
                <span>Show tracker icons</span>
            </label>
        </section>

        <!-- Date & Time Format -->
        <section style="margin-bottom: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Date & Time</h3>

            <div class="form-group">
                <label for="date_format" class="form-label">Date Format</label>
                <select name="date_format" class="form-input">
                    <option value="MM/DD/YYYY" {% if preferences.date_format=='MM/DD/YYYY' %}selected{% endif %}>
                        MM/DD/YYYY (12/06/2025)</option>
                    <option value="DD/MM/YYYY" {% if preferences.date_format=='DD/MM/YYYY' %}selected{% endif %}>
                        DD/MM/YYYY (06/12/2025)</option>
                    <option value="YYYY-MM-DD" {% if preferences.date_format=='YYYY-MM-DD' %}selected{% endif %}>
                        YYYY-MM-DD (2025-12-06)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="time_format" class="form-label">Time Format</label>
                <select name="time_format" class="form-input">
                    <option value="12h" {% if preferences.time_format=='12h' %}selected{% endif %}>12-hour (3:30 PM)
                    </option>
                    <option value="24h" {% if preferences.time_format=='24h' %}selected{% endif %}>24-hour (15:30)
                    </option>
                </select>
            </div>
        </section>

        <button type="submit" class="btn btn-primary">Save Appearance Settings</button>
    </form>
</div>

<style>
    .theme-option:hover {
        border-color: var(--color-primary);
        transform: scale(1.05);
    }

    .theme-selected {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px var(--color-focus-ring);
    }
</style>

<script>
    // Theme selection
    document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', () => {
            document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('theme-selected'));
            option.classList.add('theme-selected');
            document.getElementById('theme-input').value = option.dataset.theme;

            // Preview theme
            document.documentElement.setAttribute('data-theme', option.dataset.theme);
        });
    });

    // Font size slider
    document.getElementById('font-size').addEventListener('input', (e) => {
        document.getElementById('font-size-value').textContent = e.target.value + 'px';
        document.documentElement.style.fontSize = e.target.value + 'px';
    });

    // Form submission
    document.getElementById('appearance-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);

        try {
            const response = await fetch('/api/preferences/appearance/', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                showToast('Appearance settings saved', 'success');

                // Apply theme permanently
                const theme = formData.get('theme');
                localStorage.setItem('tracker-theme', theme);

                // Apply font size
                const fontSize = formData.get('font_size');
                localStorage.setItem('tracker-font-size', fontSize);
            } else {
                showToast(data.error || 'Failed to save settings', 'error');
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });
</script>